#!/bin/bash
echo AKEYLESS_AUTH_JWT=$TFC_WORKLOAD_IDENTITY_TOKEN >> $TFC_AGENT_ENV

# Check if TFC_WORKLOAD_IDENTITY_TOKEN is set
if [[ -z "${TFC_WORKLOAD_IDENTITY_TOKEN}" ]]; then
  echo "TFC_WORKLOAD_IDENTITY_TOKEN is not set. You can enable it by adding TFC_WORKLOAD_IDENTITY_AUDIENCE=akeyless.io to the workspace environment variables."
else
  echo "TFC_WORKLOAD_IDENTITY_TOKEN is set so populating env variables for TF_VAR_AKEYLESS_AUTH_JWT and AKEYLESS_AUTH_JWT"
  echo TF_VAR_AKEYLESS_AUTH_JWT=$TFC_WORKLOAD_IDENTITY_TOKEN >> $TFC_AGENT_ENV
  echo AKEYLESS_AUTH_JWT=$TFC_WORKLOAD_IDENTITY_TOKEN >> $TFC_AGENT_ENV
fi
